// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V={}.hasOwnProperty,J=function(e,t){function r(){this.constructor=e}for(var n in t)V.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},K=this;D=Tabletop.init({key:"0AkTjJmB1VuOXdGV1NkRnU1Y4d2pJeHd6Y2wybTZ1ZVE",wait:!0,parseNumbers:!0,simpleSheet:!0,singleton:!0,debug:!1});i="RATIO";u="TIME";o="SERIES";r="NUM";n="IDENTICAL";M=null;A=null;L=null;e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}J(t,e);t.prototype.initialize=function(e){this.set("series",e.conferenceseries);this.set("date",e.year+"-"+e.month);this.set("numMale",e.nummale);this.set("numFemale",e.numfemale);this.set("numTotal",e.numfemale+e.nummale);return this.set("ratioFemale",e.numfemale/(e.numfemale+e.nummale))};return t}(Backbone.Model);t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}J(n,t);n.prototype.tabletop={instance:D,sheet:"collection"};n.prototype.sync=Backbone.tabletopSync;n.prototype.model=e;return n}(Backbone.Collection);s=function(e){function t(){var e=this;this.path=function(n){return t.prototype.path.apply(e,arguments)};return t.__super__.constructor.apply(this,arguments)}J(t,e);t.prototype.routes={"*args":"path"};t.prototype.path=function(e){M=e.split("/")[0]||i;A=e.split("/")[1]||r;L.navigate(""+M+"/"+A,{trigger:!1});return F()};return t}(Backbone.Router);U=0;E=0;C={};d=0;v=0;H=0;c=0;h=0;z=null;I=null;m=null;w=null;k=null;y=null;a=null;f=null;l=null;W=null;X=null;x=null;T=null;g=null;b=null;q=null;R=[];P=null;_=!0;N=function(e){return""+(e*100).toFixed(1)+"%"};p=function(){U=$(".chart").width();E=$(".chart").height();C={top:35,right:20,bottom:160,left:20};d=E-C.top-C.bottom;return v=U-C.left-C.right};j=function(){p();I.range([0,v]);W.scale(I).ticks(U>600?10:5);X.call(W);x!=null&&x.attr({width:U+6});T!=null&&T.attr({width:U+6});b!=null&&b.attr({x:20+I(1)});g!=null&&g.attr({x:I(.5)}).style({opacity:U>400?1:0});P.selectAll(".tick").transition().duration(500).attr({transform:function(e){return"translate("+I(e)+", 0)"}}).style({opacity:function(e,t){return U>600||t%2===0?1:0}});a.attr({transform:"translate("+I(c)+", "+(d+150)+")"});f.attr({transform:"translate("+I(h)+", "+(d+110)+")"});l.attr({transform:"translate("+I(.2307)+", "+(d+70)+")"});if(A===r){k=d3.scale.linear().domain([0,H]).range([0,d-m.length-20]);return w=function(e){return k(e.numTotal)}}k=d3.scale.linear().domain([0,m.length]).range([0,d-m.length-20]);return w=function(e){return k(1)}};O=function(e,t){switch(M){case i:if(e.ratioFemale>t.ratioFemale)return 1;if(e.ratioFemale<t.ratioFemale)return-1;if(e.series>t.series)return 1;if(e.series<t.series)return-1;if(e.date>t.date)return 1;if(e.date<t.date)return-1;return 0;case u:if(e.date>t.date)return 1;if(e.date<t.date)return-1;if(e.event>t.event)return 1;if(e.event<t.event)return-1;return 0;case o:if(e.series>t.series)return 1;if(e.series<t.series)return-1;if(e.date>t.date)return 1;if(e.date<t.date)return-1;if(e.event>t.event)return 1;if(e.event<t.event)return-1;return 0;case r:if(e.numTotal>t.numTotal)return 1;if(e.numTotal<t.numTotal)return-1;if(e.date>t.date)return 1;if(e.date<t.date)return-1;if(e.event>t.event)return 1;if(e.event<t.event)return-1;return 0}};B=function(){var e,t,n,r,i,s;n=0;R=[];t=null;s=[];for(r=0,i=m.length;r<i;r++){e=m[r];e.x=I(e.ratioFemale);e.y=n+10;e.height=w(e);e.labelVisible=e.height>10;n+=1+e.height;R.length&&(R[R.length-1].height=e.y-R[R.length-1].y);switch(M){case u:if(e.year!==t){R.push({label:e.year,y:e.y});s.push(t=e.year)}else s.push(void 0);break;case o:if(e.series!==t){R.push({label:e.series,y:e.y});s.push(t=e.series)}else s.push(void 0);break;default:s.push(void 0)}}return s};F=function(){var e,t,n;j();m=m.sort(O);B();d3.select("#scaling").selectAll("a").classed("active",function(){return d3.select(this).attr("data-value")===A});d3.select("#sortMode").selectAll("a").classed("active",function(){return d3.select(this).attr("data-value")===M});e=y.transition().duration(500).delay(function(e,t){return e.y+e.x});e.attr({transform:function(e){return"translate("+e.x+", "+e.y+")"}});e.selectAll(".bg").attr({height:function(e){return e.height}});e.selectAll(".female").attr({height:function(e){return e.height}});e.selectAll(".male").attr({height:function(e){return e.height}});e.selectAll(".male").attr({height:function(e){return e.height}});e.selectAll("text").attr({opacity:function(e){return e.labelVisible?1:0}});q.attr({transform:"translate("+(U-220)+", 0)"});n=q.selectAll("g").data(R,function(e){return e.label});t=n.enter().append("g").classed("verticalLabel",!0);t.attr({transform:function(e){return"translate(0, "+(E/2+2*(e.y-E/2))+")"}}).style({opacity:0});t.append("text").text(function(e){return e.label}).attr({transform:"translate(-3, 12)","text-anchor":"end"});t.append("line").attr({x1:-2e3,x2:0,y1:0,y2:0}).attr({"stroke-dasharray":"1,1"});n.selectAll("text").text(function(e){return e.height>15?e.label:""});n.transition().duration(500).delay(_?1500:function(e){return e.y}).attr({transform:function(e){return"translate(0, "+e.y+")"}}).style({opacity:1});return n.exit().transition().duration(500).attr({transform:function(e){return"translate(0, "+(E/2+2*(e.y-E/2))+")"}}).style({opacity:0}).remove()};S=function(){var e,t,n;$(".chart").watch(["width"],F);m=K.eventsData.toJSON();H=d3.sum(m,function(e){return e.numTotal});c=d3.mean(m,function(e){return e.ratioFemale});h=d3.sum(m,function(e){return e.numFemale})/H;P=d3.select(".chart").append("svg").attr({width:"100%",height:"100%"});p();z=d3.scale.linear().domain([0,1]).range([0,20]);I=d3.scale.linear().domain([0,1]).range([0,v]);e=P.append("g").attr({transform:"translate("+C.left+", "+C.top+")"});W=d3.svg.axis().scale(I).tickSize(d-3).tickPadding(13).ticks(10).orient("bottom").tickFormat(function(e,t){return""+Math.floor(e*100)+"%"});d3.select("#average1").text(N(c));a=e.append("g").classed("averageLine",!0).attr({transform:"translate("+I(c)+", "+(d+150)+")"});a.append("line").attr({x1:0,x2:0,y1:0,y2:-130});a.append("text").attr({x:5}).text("Average proportion of female speakers per conference");a.append("text").classed("percentage",!0).attr({x:5,y:-15}).text(N(c));d3.select("#average2").text(N(h));f=e.append("g").classed("averageLine",!0).attr({transform:"translate("+I(h)+", "+(d+110)+")"});f.append("line").attr({x1:0,x2:0,y1:0,y2:-90});f.append("text").attr({x:5}).text("Overall proportion of female speakers");f.append("text").classed("percentage",!0).attr({x:5,y:-15}).text(N(h));l=e.append("g").classed("averageLine target",!0).attr({transform:"translate("+I(.2307)+", "+(d+70)+")"});l.append("line").attr({x1:0,x2:0,y1:0,y2:-50});l.append("text").attr({x:5}).text("Proportion of women in datavisualization");l.append("text").classed("percentage",!0).attr({x:5,y:-15}).text(N(.2307));x=e.append("rect").attr({x:-C.left-3,y:-C.top-1,width:U+6,height:C.top-5}).classed("legendBorder",!0);T=e.append("rect").attr({x:-C.left-3,y:d-1,width:U+6,height:30}).classed("legendBorder",!0);q=e.append("g");X=e.append("g").classed({"axisLegend x":!0}).call(W).selectAll("line").attr({"stroke-dasharray":"1,4"});X.selectAll(".tick").style("opacity",0);e.append("text").attr({x:-20+I(0),y:-15}).classed("male legend",!0).text("Only male speakers");b=e.append("text").attr({x:20+I(1),y:-15,"text-anchor":"end"}).classed("female legend",!0).text("Only female speakers");g=e.append("text").attr({x:I(.5),y:-15,"text-anchor":"middle"}).classed("legend",!0).text("Equal mixture");y=e.append("g").selectAll("g.event").data(m,function(e){return e.event});t=y.enter().append("g").classed({event:!0}).attr({title:function(e){return'<table>\n	\n	<tr >\n		<td class="titleCell" rowspan="2">\n			<div class="year">'+e.year+'</div>\n			<div class="title">'+e.event+'</div>\n		</td>\n		<td class="numbers">\n			<span class="numFemale">'+e.numFemale+'</span>\n		</td>\n		<td class="labels">\n			female speaker'+(e.numFemale!==1?"s":"")+'\n		</td>\n	</tr>\n	<tr>\n		<td class="numbers">\n			<span class="numMale">'+e.numMale+'</span>\n		</td>\n		<td class="labels">\n			male speaker'+(e.numMale!==1?"s":"")+"\n		</td>\n	</tr>\n</table>"}});t.attr({transform:function(e){return"translate(-200, -100)"}});t.append("rect").classed("bg",!0).attr({x:-z(.5),y:0,width:function(e){return z(1)}});t.append("rect").classed("male",!0).attr({x:function(e){return-z(.5)-1},y:0,width:function(e){return z(1-e.ratioFemale)}});t.append("rect").classed("female",!0).attr({x:function(e){return-z(.5)+z(1-e.ratioFemale)},y:0,width:function(e){return z(e.ratioFemale)}});n=t.append("g").classed("label",!0).attr({transform:"translate("+(z(.5)+5)+", "+11+")"});n.append("text").text(function(e){return e.event}).style({stroke:"#FFF","stroke-width":"2px"});n.append("text").text(function(e){return e.event});F();y.style("cursor","pointer");y.each(function(){return $(this).qtip({content:!0,position:{my:"left bottom",at:"right center",target:"mouse",adjust:{x:5,y:0}},style:{classes:"qtip-light"}})});y.on("click",function(e){if(!!e.url)return window.open(e.url)});d3.select("#sortMode").selectAll("a").on("click",function(e){_=!0;M=d3.select(this).attr("data-value");return L.navigate(""+M+"/"+A,{trigger:!0})});d3.select("#scaling").selectAll("a").on("click",function(e){_=!1;A=d3.select(this).attr("data-value");return L.navigate(""+M+"/"+A,{trigger:!0})});return K};$(function(){L=new s;K.eventsData=new t;K.eventsData.fetch({success:function(){S();return Backbone.history.start()}});return $("a").each(function(){var e;if(((e=$(this).attr("href"))!=null?e.indexOf("#"):void 0)===0)return $(this).click(function(){return $("html, body").animate({scrollTop:"0px"})})})})}).call(this);